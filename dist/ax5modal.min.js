"use strict";!function(){var t,e=ax5.ui,i=ax5.util;e.addClass({className:"modal",version:"${VERSION}"},function(){var o=function(){var o=this,a=void 0,d={mousedown:ax5.info.supportTouch?"touchstart":"mousedown",mousemove:ax5.info.supportTouch?"touchmove":"mousemove",mouseup:ax5.info.supportTouch?"touchend":"mouseup"},n=function(t){var e=t;return"changedTouches"in t&&(e=t.changedTouches[0]),{clientX:e.clientX,clientY:e.clientY}};this.instanceId=ax5.getGuid(),this.config={id:"ax5-modal-"+this.instanceId,position:{left:"center",top:"middle",margin:10},minimizePosition:"bottom-right",clickEventName:"click",theme:"default",width:300,height:400,closeToEsc:!0,disableDrag:!1,animateTime:250},this.activeModal=null,this.watingModal=!1,this.$={},a=this.config;var s=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),!0},l=function(e,i){var o={modalId:e,theme:i.theme,header:i.header,fullScreen:i.fullScreen?"fullscreen":"",styles:"",iframe:i.iframe,iframeLoadingMsg:i.iframeLoadingMsg};return i.zIndex&&(o.styles+="z-index:"+i.zIndex+";"),i.absolute&&(o.styles+="position:absolute;"),o.iframe&&"string"==typeof o.iframe.param&&(o.iframe.param=ax5.util.param(o.iframe.param)),t.tmpl.get.call(this,"content",o,{})},h=function(t,e){var h=void 0;jQuery(document.body).append(l.call(this,t.id,t)),this.activeModal=jQuery("#"+t.id),this.activeModalConfig=t,this.$={root:this.activeModal,header:this.activeModal.find('[data-modal-els="header"]'),body:this.activeModal.find('[data-modal-els="body"]')},t.iframe?(this.$["iframe-wrap"]=this.activeModal.find('[data-modal-els="iframe-wrap"]'),this.$.iframe=this.activeModal.find('[data-modal-els="iframe"]'),this.$["iframe-form"]=this.activeModal.find('[data-modal-els="iframe-form"]'),this.$["iframe-loading"]=this.activeModal.find('[data-modal-els="iframe-loading"]')):this.$["body-frame"]=this.activeModal.find('[data-modal-els="body-frame"]'),this.align(),h={self:this,id:t.id,theme:t.theme,width:t.width,height:t.height,state:"open",$:this.$},t.iframe&&(this.$["iframe-wrap"].css({height:t.height}),this.$.iframe.css({height:t.height}),this.$["iframe-form"].attr({method:t.iframe.method}),this.$["iframe-form"].attr({target:t.id+"-frame"}),this.$["iframe-form"].attr({action:t.iframe.url}),this.$.iframe.on("load",function(){h.state="load",t.iframeLoadingMsg&&this.$["iframe-loading"].hide(),s.call(this,t,h)}.bind(this)),t.iframeLoadingMsg||this.$.iframe.show(),this.$["iframe-form"].submit()),e&&e.call(h,h),this.watingModal||s.call(this,t,h),t.closeToEsc&&jQuery(window).bind("keydown.ax-modal",function(t){f.call(this,t||window.event)}.bind(this)),jQuery(window).bind("resize.ax-modal",function(t){this.align(null,t||window.event)}.bind(this)),this.activeModal.on(a.clickEventName,"[data-modal-header-btn]",function(e){r.call(this,e||window.event,t)}.bind(this)),this.$.header.off(d.mousedown).off("dragstart").on(d.mousedown,function(e){if(t.isFullScreen)return!1;var a=i.findParentNode(e.target,function(t){if(t.getAttribute("data-modal-header-btn"))return!0});a||1==t.disableDrag||(o.mousePosition=n(e),u.on.call(o))}).on("dragstart",function(t){return i.stopEvent(t.originalEvent),!1}),this.activeModal.off(d.mousedown).off("dragstart").on(d.mousedown,"[data-ax5modal-resizer]",function(e){return!t.isFullScreen&&(o.mousePosition=n(e),void m.on.call(o,this.getAttribute("data-ax5modal-resizer")))}).on("dragstart",function(t){return i.stopEvent(t.originalEvent),!1})},r=function(t,e,o,a,d){var n=void 0;t.srcElement&&(t.target=t.srcElement),a=i.findParentNode(t.target,function(t){if(t.getAttribute("data-modal-header-btn"))return!0}),a&&(d=a.getAttribute("data-modal-header-btn"),n={self:this,key:d,value:e.header.btns[d],dialogId:e.id,btnTarget:a},e.header.btns[d].onClick&&e.header.btns[d].onClick.call(n,d)),n=null,e=null,o=null,a=null,d=null},f=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()},c={"top-left":function(){this.align({left:"left",top:"top"})},"top-right":function(){this.align({left:"right",top:"top"})},"bottom-left":function(){this.align({left:"left",top:"bottom"})},"bottom-right":function(){this.align({left:"right",top:"bottom"})},"center-middle":function(){this.align({left:"center",top:"middle"})}},u={on:function(){var t=this.activeModal.css("z-index"),e=this.activeModal.position(),i={width:this.activeModal.outerWidth(),height:this.activeModal.outerHeight()},n={width:jQuery(window).width(),height:jQuery(window).height(),scrollLeft:this.activeModalConfig.absolute?0:jQuery(document).scrollLeft(),scrollTop:this.activeModalConfig.absolute?0:jQuery(document).scrollTop()},s=function(t){return o.__dx=t.clientX-o.mousePosition.clientX,o.__dy=t.clientY-o.mousePosition.clientY,l>e.left+o.__dx?o.__dx=-e.left:h<e.left+o.__dx&&(o.__dx=h-e.left),r>e.top+o.__dy?o.__dy=-e.top:f<e.top+o.__dy&&(o.__dy=f-e.top),{left:e.left+o.__dx+n.scrollLeft,top:e.top+o.__dy+n.scrollTop}},l=0,h=n.width-i.width,r=0,f=n.height-i.height;o.__dx=0,o.__dy=0,o.resizer||(o.resizerBg=jQuery('<div class="ax5modal-resizer-background" ondragstart="return false;"></div>'),o.resizer=jQuery('<div class="ax5modal-resizer" ondragstart="return false;"></div>'),o.resizerBg.css({zIndex:t}),o.resizer.css({left:e.left+n.scrollLeft,top:e.top+n.scrollTop,width:i.width,height:i.height,zIndex:t+1}),jQuery(document.body).append(o.resizerBg).append(o.resizer),o.activeModal.addClass("draged")),jQuery(document.body).bind(d.mousemove+".ax5modal-"+a.id,function(t){o.resizer.css(s(t))}).bind(d.mouseup+".ax5layout-"+this.instanceId,function(t){u.off.call(o)}).bind("mouseleave.ax5layout-"+this.instanceId,function(t){u.off.call(o)}),jQuery(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){var t=function(){var t=this.resizer.offset();this.activeModalConfig.absolute||(t.left-=jQuery(document).scrollLeft(),t.top-=jQuery(document).scrollTop()),this.activeModal.css(t),t=null};this.resizer&&(this.activeModal.removeClass("draged"),t.call(this),this.resizer.remove(),this.resizer=null,this.resizerBg.remove(),this.resizerBg=null),jQuery(document.body).unbind(d.mousemove+".ax5modal-"+a.id).unbind(d.mouseup+".ax5modal-"+a.id).unbind("mouseleave.ax5modal-"+a.id),jQuery(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}},m={on:function(t){var e=this.activeModal.css("z-index"),i=this.activeModal.position(),n={width:this.activeModal.outerWidth(),height:this.activeModal.outerHeight()},s={width:jQuery(window).width(),height:jQuery(window).height(),scrollLeft:this.activeModalConfig.absolute?0:jQuery(document).scrollLeft(),scrollTop:this.activeModalConfig.absolute?0:jQuery(document).scrollTop()},l={top:function(t){return t.shiftKey?{left:i.left,top:i.top+o.__dy,width:n.width,height:n.height-2*o.__dy}:t.altKey?{left:i.left+o.__dy,top:i.top+o.__dy,width:n.width-2*o.__dy,height:n.height-2*o.__dy}:{left:i.left,top:i.top+o.__dy,width:n.width,height:n.height-o.__dy}},bottom:function(t){return t.shiftKey?{left:i.left,top:i.top-o.__dy,width:n.width,height:n.height+2*o.__dy}:t.altKey?{left:i.left-o.__dy,top:i.top-o.__dy,width:n.width+2*o.__dy,height:n.height+2*o.__dy}:{left:i.left,top:i.top,width:n.width,height:n.height+o.__dy}},left:function(t){return t.shiftKey?{left:i.left+o.__dx,top:i.top,width:n.width-2*o.__dx,height:n.height}:t.altKey?{left:i.left+o.__dx,top:i.top+o.__dx,width:n.width-2*o.__dx,height:n.height-2*o.__dx}:{left:i.left+o.__dx,top:i.top,width:n.width-o.__dx,height:n.height}},right:function(t){return t.shiftKey?{left:i.left-o.__dx,top:i.top,width:n.width+2*o.__dx,height:n.height}:t.altKey?{left:i.left-o.__dx,top:i.top-o.__dx,width:n.width+2*o.__dx,height:n.height+2*o.__dx}:{left:i.left,top:i.top,width:n.width+o.__dx,height:n.height}},"top-left":function(t){return t.shiftKey||t.altKey?{left:i.left+o.__dx,top:i.top+o.__dy,width:n.width-2*o.__dx,height:n.height-2*o.__dy}:{left:i.left+o.__dx,top:i.top+o.__dy,width:n.width-o.__dx,height:n.height-o.__dy}},"top-right":function(t){return t.shiftKey||t.altKey?{left:i.left-o.__dx,top:i.top+o.__dy,width:n.width+2*o.__dx,height:n.height-2*o.__dy}:{left:i.left,top:i.top+o.__dy,width:n.width+o.__dx,height:n.height-o.__dy}},"bottom-left":function(t){return t.shiftKey||t.altKey?{left:i.left+o.__dx,top:i.top-o.__dy,width:n.width-2*o.__dx,height:n.height+2*o.__dy}:{left:i.left+o.__dx,top:i.top,width:n.width-o.__dx,height:n.height+o.__dy}},"bottom-right":function(t){return t.shiftKey||t.altKey?{left:i.left-o.__dx,top:i.top-o.__dy,width:n.width+2*o.__dx,height:n.height+2*o.__dy}:{left:i.left,top:i.top,width:n.width+o.__dx,height:n.height+o.__dy}}},h=function(e){return o.__dx=e.clientX-o.mousePosition.clientX,r>i.left+o.__dx?o.__dx=-i.left:f>n.width-o.__dx&&(o.__dx=n.width-f),o.__dy=e.clientY-o.mousePosition.clientY,c>i.top+o.__dy?o.__dy=-i.top:u>n.height-o.__dy&&(o.__dy=n.height-u),l[t](e)};this.activeModalConfig.absolute||(i.left+=s.scrollLeft,i.top+=s.scrollTop);var r=0,f=100,c=0,u=100,g={top:"row-resize",bottom:"row-resize",left:"col-resize",right:"col-resize","top-left":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize","bottom-right":"nwse-resize"};o.__dx=0,o.__dy=0,o.resizer||(o.resizerBg=jQuery('<div class="ax5modal-resizer-background" ondragstart="return false;"></div>'),o.resizer=jQuery('<div class="ax5modal-resizer" ondragstart="return false;"></div>'),o.resizerBg.css({zIndex:e,cursor:g[t]}),o.resizer.css({left:i.left,top:i.top,width:n.width,height:n.height,zIndex:e+1,cursor:g[t]}),jQuery(document.body).append(o.resizerBg).append(o.resizer),o.activeModal.addClass("draged")),jQuery(document.body).bind(d.mousemove+".ax5modal-"+a.id,function(t){o.resizer.css(h(t))}).bind(d.mouseup+".ax5layout-"+this.instanceId,function(t){m.off.call(o)}).bind("mouseleave.ax5layout-"+this.instanceId,function(t){m.off.call(o)}),jQuery(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){var t=function(){var t=this.resizer.offset();jQuery.extend(t,{width:this.resizer.width(),height:this.resizer.height()}),this.activeModalConfig.absolute||(t.left-=jQuery(document).scrollLeft(),t.top-=jQuery(document).scrollTop()),this.activeModal.css(t),t=null};this.resizer&&(this.activeModal.removeClass("draged"),t.call(this),this.resizer.remove(),this.resizer=null,this.resizerBg.remove(),this.resizerBg=null),jQuery(document.body).unbind(d.mousemove+".ax5modal-"+a.id).unbind(d.mouseup+".ax5modal-"+a.id).unbind("mouseleave.ax5modal-"+a.id),jQuery(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}};this.init=function(){this.onStateChanged=a.onStateChanged},this.open=function(t,e,i){return"undefined"==typeof i&&(i=0),this.activeModal?i<3&&(this.watingModal=!0,setTimeout(function(){this.open(t,e,i+1)}.bind(this),a.animateTime)):(t=o.modalConfig=jQuery.extend(!0,{},a,t),h.call(this,t,e),this.watingModal=!1),this},this.close=function(t){return this.activeModal&&(t=o.modalConfig,this.activeModal.addClass("destroy"),jQuery(window).unbind("keydown.ax-modal"),jQuery(window).unbind("resize.ax-modal"),setTimeout(function(){if(this.activeModal){if(t.iframe){var e=this.$.iframe;if(e){var i=e.get(0),o=i.contentDocument?i.contentDocument:i.contentWindow.document;try{$(o.body).children().each(function(){$(this).remove()})}catch(a){}o.innerHTML="",e.attr("src","about:blank").remove(),window.CollectGarbage&&window.CollectGarbage()}}this.activeModal.remove(),this.activeModal=null}this.watingModal||s.call(this,t,{self:this,state:"close"})}.bind(this),a.animateTime)),this.minimized=!1,this},this.minimize=function(){return function(t){if(this.minimized!==!0){var e=o.modalConfig;"undefined"==typeof t&&(t=a.minimizePosition),this.minimized=!0,this.$.body.hide(),o.modalConfig.originalHeight=e.height,o.modalConfig.height=0,c[t].call(this),s.call(this,e,{self:this,state:"minimize"})}return this}}(),this.maximize=function(){var t=o.modalConfig;return this.minimized&&(this.minimized=!1,this.$.body.show(),o.modalConfig.height=o.modalConfig.originalHeight,o.modalConfig.originalHeight=void 0,this.align({left:"center",top:"middle"}),s.call(this,t,{self:this,state:"restore"})),this},this.css=function(t){return this.activeModal&&!o.fullScreen&&(this.activeModal.css(t),t.width&&(o.modalConfig.width=this.activeModal.width()),t.height&&(o.modalConfig.height=this.activeModal.height(),this.$.iframe&&(this.$["iframe-wrap"].css({height:o.modalConfig.height}),this.$.iframe.css({height:o.modalConfig.height})))),this},this.setModalConfig=function(t){return o.modalConfig=jQuery.extend({},o.modalConfig,t),this.align(),this},this.align=function(){return function(t,e){if(!this.activeModal)return this;var a=o.modalConfig,d={width:a.width,height:a.height},n=a.isFullScreen=function(t){return"undefined"!=typeof t&&(i.isFunction(t)?t():void 0)}(a.fullScreen);return n?(a.header&&this.$.header.show(),d.width=jQuery(window).width(),d.height=a.height,d.left=0,d.top=0):(a.header&&this.$.header.show(),t&&jQuery.extend(!0,a.position,t),a.header?(a.headerHeight=this.$.header.outerHeight(),d.height+=a.headerHeight):a.headerHeight=0,"left"==a.position.left?d.left=a.position.margin||0:"right"==a.position.left?d.left=jQuery(window).width()-d.width-(a.position.margin||0):"center"==a.position.left?d.left=jQuery(window).width()/2-d.width/2:d.left=a.position.left||0,"top"==a.position.top?d.top=a.position.margin||0:"bottom"==a.position.top?d.top=jQuery(window).height()-d.height-(a.position.margin||0):"middle"==a.position.top?d.top=jQuery(window).height()/2-d.height/2:d.top=a.position.top||0,d.left<0&&(d.left=0),d.top<0&&(d.top=0)),this.activeModal.css(d),a.iframe&&(this.$["iframe-wrap"].css({height:d.height-a.headerHeight}),this.$.iframe.css({height:d.height-a.headerHeight})),this}}(),this.main=function(){e.modal_instance=e.modal_instance||[],e.modal_instance.push(this),arguments&&i.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return o}()),t=ax5.ui.modal}(),function(){var t=ax5.ui.modal,e=function(){return' \n        <div id="{{modalId}}" data-modal-els="root" class="ax5modal {{theme}} {{fullscreen}}" style="{{styles}}">\n            {{#header}}\n            <div class="ax-modal-header" data-modal-els="header">\n                {{{title}}}\n                {{#btns}}\n                    <div class="ax-modal-header-addon">\n                    {{#@each}}\n                    <button tabindex="-1" data-modal-header-btn="{{@key}}" class="{{@value.theme}}">{{{@value.label}}}</button>\n                    {{/@each}}\n                    </div>\n                {{/btns}}\n            </div>\n            {{/header}}\n            <div class="ax-modal-body" data-modal-els="body">\n            {{#iframe}}\n                <div data-modal-els="iframe-wrap" style="-webkit-overflow-scrolling: touch; overflow: auto;position: relative;">\n                    <table data-modal-els="iframe-loading" style="width:100%;height:100%;"><tr><td style="text-align: center;vertical-align: middle">{{{iframeLoadingMsg}}}</td></tr></table>\n                    <iframe name="{{modalId}}-frame" src="" width="100%" height="100%" frameborder="0" data-modal-els="iframe" style="position: absolute;left:0;top:0;"></iframe>\n                </div>\n                <form name="{{modalId}}-form" data-modal-els="iframe-form">\n                <input type="hidden" name="modalId" value="{{modalId}}" />\n                {{#param}}\n                {{#@each}}\n                <input type="hidden" name="{{@key}}" value="{{@value}}" />\n                {{/@each}}\n                {{/param}}\n                </form>\n            {{/iframe}}\n            {{^iframe}}\n                <div data-modal-els="body-frame" style="position: absolute;left:0;top:0;width:100%;height:100%;"></div>\n            {{/iframe}}\n            </div>\n            <div data-ax5modal-resizer="top"></div>\n            <div data-ax5modal-resizer="right"></div>\n            <div data-ax5modal-resizer="bottom"></div>\n            <div data-ax5modal-resizer="left"></div>\n            <div data-ax5modal-resizer="top-left"></div>\n            <div data-ax5modal-resizer="top-right"></div>\n            <div data-ax5modal-resizer="bottom-left"></div>\n            <div data-ax5modal-resizer="bottom-right"></div>\n        </div>\n        '};t.tmpl={content:e,get:function(e,i,o){return ax5.mustache.render(t.tmpl[e].call(this,o),i)}}}();
//# sourceMappingURL=ax5modal.min.js.map
