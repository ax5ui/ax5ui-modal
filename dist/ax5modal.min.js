"use strict";!function(i,t){var e=ax5.util,a=function(){var i,a=this;t&&t.call(this),this.activeModal=null,this.$={},this.config={position:{left:"center",top:"middle",margin:10},clickEventName:"click",theme:"default",width:300,height:400,closeToEsc:!0,animateTime:250},i=this.config,i.id="ax5-modal-"+ax5.getGuid();var o=function(i,t){return i&&i.onStateChanged?i.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),!0},n=function(){return'\n                <div id="{{modalId}}" data-modal-els="root" class="ax5-ui-modal {{theme}} {{fullscreen}}" style="{{styles}}">\n                    <div class="ax-modal-body" data-modal-els="body">\n                    {{#iframe}}\n                        <div data-modal-els="iframe-wrap" style="-webkit-overflow-scrolling: touch; overflow: auto;position: relative;">\n                        <iframe name="{{modalId}}-frame" src="" width="100%" height="100%" frameborder="0" data-modal-els="iframe" style="position: absolute;left:0;top:0;"></iframe>\n                        </div>\n                        <form name="{{modalId}}-form" data-modal-els="iframe-form">\n                        <input type="hidden" name="modalId" value="{{modalId}}" />\n                        {{#param}}\n                        {{#@each}}\n                        <input type="hidden" name="{{@key}}" value="{{@value}}" />\n                        {{/@each}}\n                        {{/param}}\n                        </form>\n                    {{/iframe}}\n                    </div>\n                </div>\n                '},s=function(i,t){var e={modalId:i,theme:t.theme,fullScreen:t.fullScreen?"fullscreen":"",styles:[],iframe:t.iframe};return t.zIndex&&e.styles.push("z-index:"+t.zIndex),e.iframe&&"string"==typeof e.iframe.param&&(e.iframe.param=ax5.util.param(e.iframe.param)),ax5.mustache.render(n(),e)},d=function(i,t){var e;jQuery(document.body).append(s.call(this,i.id,i)),this.activeModal=jQuery("#"+i.id),this.$={root:this.activeModal.find('[data-modal-els="root"]'),body:this.activeModal.find('[data-modal-els="body"]')},i.iframe&&(this.$["iframe-wrap"]=this.activeModal.find('[data-modal-els="iframe-wrap"]'),this.$.iframe=this.activeModal.find('[data-modal-els="iframe"]'),this.$["iframe-form"]=this.activeModal.find('[data-modal-els="iframe-form"]')),h.call(this),e={self:this,id:i.id,theme:i.theme,width:i.width,height:i.height,state:"open",$:this.$},i.iframe&&(this.$["iframe-wrap"].css({height:i.height}),this.$.iframe.css({height:i.height}),this.$["iframe-form"].attr({method:i.iframe.method}),this.$["iframe-form"].attr({target:i.id+"-frame"}),this.$["iframe-form"].attr({action:i.iframe.url}),this.$.iframe.on("load",function(){e.state="load",o.call(this,i,e)}.bind(this)),this.$["iframe-form"].submit()),t&&t.call(e),o.call(this,i,e),i.closeToEsc&&jQuery(window).bind("keydown.ax-modal",function(i){l.call(this,i||window.event)}.bind(this)),jQuery(window).bind("resize.ax-modal",function(i){h.call(this,null,i||window.event)}.bind(this))},h=function(i,t){if(!this.activeModal)return this;var e=a.modalConfig,o={width:e.width,height:e.height};return e.fullScreen?(o.width=jQuery(window).width(),o.height=jQuery(window).height(),o.left=0,o.top=0,e.iframe&&(this.$["iframe-wrap"].css({height:o.height}),this.$.iframe.css({height:o.height}))):(i&&jQuery.extend(!0,e.position,i),"left"==e.position.left?o.left=e.position.margin||0:"right"==e.position.left?o.left=jQuery(window).width()-o.width-(e.position.margin||0):"center"==e.position.left?o.left=jQuery(window).width()/2-o.width/2:o.left=e.position.left||0,"top"==e.position.top?o.top=e.position.margin||0:"bottom"==e.position.top?o.top=jQuery(window).height()-o.height-(e.position.margin||0):"middle"==e.position.top?o.top=jQuery(window).height()/2-o.height/2:o.top=e.position.top||0),this.activeModal.css(o),this},l=function(i){i.keyCode==ax5.info.eventKeys.ESC&&this.close()};this.init=function(){this.onStateChanged=i.onStateChanged},this.open=function(t,o){return e.isString(t)&&(t={title:i.title,msg:t}),a.modalConfig={},jQuery.extend(!0,a.modalConfig,i),jQuery.extend(!0,a.modalConfig,t),t=a.modalConfig,d.call(this,t,o),this},this.close=function(t,e){return this.activeModal&&(t=a.modalConfig,this.activeModal.addClass("destroy"),jQuery(window).unbind("keydown.ax-modal"),jQuery(window).unbind("resize.ax-modal"),setTimeout(function(){this.activeModal.remove(),this.activeModal=null,e={self:this,state:"close"},o.call(this,t,{self:this,state:"close"})}.bind(this),i.animateTime)),this},this.css=function(i){return this.activeModal&&!a.fullScreen&&(this.activeModal.css(i),i.width&&(a.modalConfig.width=this.activeModal.width()),i.height&&(a.modalConfig.height=this.activeModal.height(),this.$.iframe&&(this.$["iframe-wrap"].css({height:a.modalConfig.height}),this.$.iframe.css({height:a.modalConfig.height})))),this},this.main=function(){arguments&&e.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};i.modal=function(){return e.isFunction(t)&&(a.prototype=new t),a}()}(ax5.ui,ax5.ui.root);