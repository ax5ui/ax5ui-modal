!function(t,i){var e=ax5.util,a=function(){var t,a=this;this.main=function(){i&&i.call(this),this.config={clickEventName:"click",theme:"default",width:300,height:400,closeToEsc:!0,animateTime:250}}.apply(this,arguments),this.activeModal=null,this.$={},t=this.config,t.id="ax5-modal-"+ax5.getGuid(),this.init=function(){},this.getContent=function(t,i){var e=[];if(e.push('<div id="'+t+'" data-modal-els="root" class="ax5-ui-modal '+i.theme+'">'),e.push('<div class="ax-modal-body" data-modal-els="body">'),i.http){e.push('<iframe name="'+t+'-frame" src="" width="100%" height="100%" frameborder="0" data-modal-els="iframe"></iframe>'),e.push('<form name="'+t+'-form" data-modal-els="iframe-form">'),e.push('<input type="hidden" name="modalId" value="'+t+'" />');for(var a in i.http.param)e.push('<input type="hidden" name="'+a+'" value="'+i.http.param[a]+'" />');e.push("</form>")}return e.push("</div>"),e.push("</div>"),e.join("")},this.open=function(i,o){return e.isString(i)&&(i={title:t.title,msg:i}),a.modalConfig={},jQuery.extend(!0,a.modalConfig,t),jQuery.extend(!0,a.modalConfig,i),i=a.modalConfig,this._open(i,o),this},this._open=function(i,e){var a,o;a={width:i.width,height:i.height},jQuery(document.body).append(this.getContent(i.id,i)),this.activeModal=jQuery("#"+i.id),this.$={root:this.activeModal.find('[data-modal-els="root"]'),heading:this.activeModal.find('[data-modal-els="heading"]'),body:this.activeModal.find('[data-modal-els="body"]')},i.http&&(this.$.iframe=this.activeModal.find('[data-modal-els="iframe"]'),this.$["iframe-form"]=this.activeModal.find('[data-modal-els="iframe-form"]')),"undefined"==typeof i.position||"center"===i.position?(a.top=window.innerHeight/2-a.height/2,a.left=window.innerWidth/2-a.width/2):(a.left=i.position.left||0,a.top=i.position.top||0),this.activeModal.css(a),o={id:i.id,theme:i.theme,width:i.width,height:i.height,state:"open"},i.http&&(this.$.iframe.css({height:a.height-t.heading.height}),this.$["iframe-form"].attr({method:i.http.method}),this.$["iframe-form"].attr({target:i.id+"-frame"}),this.$["iframe-form"].attr({action:i.http.url}),this.$.iframe.on("load",function(){i&&i.onStateChanged&&(o.state="load",i.onStateChanged.call(o,o))}.bind(this)),this.$["iframe-form"].elements[0].submit()),jQuery.extend(!0,o,this.$),e&&e.call(o),i&&i.onStateChanged&&i.onStateChanged.call(o,o),t.closeToEsc&&jQuery(window).bind("keydown.ax-modal",function(t){this.onkeyup(t||window.event)}.bind(this)),jQuery(window).bind("resize.ax-modal",function(t){this.align(t||window.event)}.bind(this))},this.align=function(t){if(!this.activeModal)return this;var i=a.modalConfig,e={width:i.width,height:i.height};return"undefined"==typeof i.position||"center"===i.position?(e.top=window.innerHeight/2-e.height/2,e.left=window.innerWidth/2-e.width/2):(e.left=i.position.left||0,e.top=i.position.top||0),this.activeModal.css(e),this},this.onkeyup=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()},this.close=function(i,e){return this.activeModal&&(i=a.modalConfig,this.activeModal.addClass("destroy"),jQuery(window).unbind("keydown.ax-modal"),jQuery(window).unbind("resize.ax-modal"),setTimeout(function(){this.activeModal.remove(),this.activeModal=null,i&&i.onStateChanged&&(e={state:"close"},i.onStateChanged.call(e,e))}.bind(this),t.animateTime)),this}};e.isFunction(i)&&(a.prototype=new i),t.modal=a}(ax5.ui,ax5.ui.root);