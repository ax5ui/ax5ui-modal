"use strict";!function(){var t=ax5.ui,i=ax5.ui.root,e=ax5.util,o="ax5modal",a="0.7.1",n=function(){var t,n=this,d={mousedown:ax5.info.supportTouch?"touchstart":"mousedown",mousemove:ax5.info.supportTouch?"touchmove":"mousemove",mouseup:ax5.info.supportTouch?"touchend":"mouseup"},s=function(t){var i=t;return"changedTouches"in t&&(i=t.changedTouches[0]),{clientX:i.clientX,clientY:i.clientY}};i&&i.call(this),this.name=o,this.version=a,this.instanceId=ax5.getGuid(),this.config={id:"ax5-modal-"+this.instanceId,position:{left:"center",top:"middle",margin:10},minimizePosition:"bottom-right",clickEventName:"click",theme:"default",width:300,height:400,closeToEsc:!0,animateTime:250},this.activeModal=null,this.$={},t=this.config;var l=function(t,i){return t&&t.onStateChanged?t.onStateChanged.call(i,i):this.onStateChanged&&this.onStateChanged.call(i,i),!0},h=function(){return' \n                <div id="{{modalId}}" data-modal-els="root" class="ax5modal {{theme}} {{fullscreen}}" style="{{styles}}">\n                    {{#header}}\n                    <div class="ax-modal-header" data-modal-els="header">\n                        {{{title}}}\n                        {{#btns}}\n                            <div class="ax-modal-header-addon">\n                            {{#@each}}\n                            <a tabindex="-1" data-modal-header-btn="{{@key}}" class="{{@value.theme}}">{{{@value.label}}}</a>\n                            {{/@each}}\n                            </div>\n                        {{/btns}}\n                    </div>\n                    {{/header}}\n                    <div class="ax-modal-body" data-modal-els="body">\n                    {{#iframe}}\n                        <div data-modal-els="iframe-wrap" style="-webkit-overflow-scrolling: touch; overflow: auto;position: relative;">\n                        <iframe name="{{modalId}}-frame" src="" width="100%" height="100%" frameborder="0" data-modal-els="iframe" style="position: absolute;left:0;top:0;"></iframe>\n                        </div>\n                        <form name="{{modalId}}-form" data-modal-els="iframe-form">\n                        <input type="hidden" name="modalId" value="{{modalId}}" />\n                        {{#param}}\n                        {{#@each}}\n                        <input type="hidden" name="{{@key}}" value="{{@value}}" />\n                        {{/@each}}\n                        {{/param}}\n                        </form>\n                    {{/iframe}}\n                    </div>\n                </div>\n                '},r=function(t,i){var e={modalId:t,theme:i.theme,header:i.header,fullScreen:i.fullScreen?"fullscreen":"",styles:[],iframe:i.iframe};return i.zIndex&&e.styles.push("z-index:"+i.zIndex),e.iframe&&"string"==typeof e.iframe.param&&(e.iframe.param=ax5.util.param(e.iframe.param)),ax5.mustache.render(h(),e)},m=function(i,o){var a;jQuery(document.body).append(r.call(this,i.id,i)),this.activeModal=jQuery("#"+i.id),this.$={root:this.activeModal.find('[data-modal-els="root"]'),header:this.activeModal.find('[data-modal-els="header"]'),body:this.activeModal.find('[data-modal-els="body"]')},i.iframe&&(this.$["iframe-wrap"]=this.activeModal.find('[data-modal-els="iframe-wrap"]'),this.$.iframe=this.activeModal.find('[data-modal-els="iframe"]'),this.$["iframe-form"]=this.activeModal.find('[data-modal-els="iframe-form"]')),this.align(),a={self:this,id:i.id,theme:i.theme,width:i.width,height:i.height,state:"open",$:this.$},i.iframe&&(this.$["iframe-wrap"].css({height:i.height}),this.$.iframe.css({height:i.height}),this.$["iframe-form"].attr({method:i.iframe.method}),this.$["iframe-form"].attr({target:i.id+"-frame"}),this.$["iframe-form"].attr({action:i.iframe.url}),this.$.iframe.on("load",function(){a.state="load",l.call(this,i,a)}.bind(this)),this.$["iframe-form"].submit()),o&&o.call(a),l.call(this,i,a),i.closeToEsc&&jQuery(window).bind("keydown.ax-modal",function(t){u.call(this,t||window.event)}.bind(this)),jQuery(window).bind("resize.ax-modal",function(t){this.align(null,t||window.event)}.bind(this)),this.activeModal.find("[data-modal-header-btn]").on(t.clickEventName,function(t){c.call(this,t||window.event,i)}.bind(this)),this.$.header.bind(d.mousedown,function(t){n.mousePosition=s(t),g.on.call(n)}).bind("dragstart",function(t){return e.stopEvent(t),!1})},c=function(t,i,o,a,n){var d;t.srcElement&&(t.target=t.srcElement),a=e.findParentNode(t.target,function(t){return t.getAttribute("data-modal-header-btn")?!0:void 0}),a&&(n=a.getAttribute("data-modal-header-btn"),d={self:this,key:n,value:i.header.btns[n],dialogId:i.id,btnTarget:a},i.header.btns[n].onClick&&i.header.btns[n].onClick.call(d,n)),d=null,i=null,o=null,a=null,n=null},u=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()},f={"top-left":function(){this.align({left:"left",top:"top"})},"top-right":function(){this.align({left:"right",top:"top"})},"bottom-left":function(){this.align({left:"left",top:"bottom"})},"bottom-right":function(){this.align({left:"right",top:"bottom"})},"center-middle":function(){this.align({left:"center",top:"middle"})}},g={on:function(){var i=this.activeModal.position(),e={width:this.activeModal.outerWidth(),height:this.activeModal.outerHeight()},o={width:jQuery(window).width(),height:jQuery(window).height()},a=function(t){n.__dx=t.clientX-n.mousePosition.clientX,n.__dy=t.clientY-n.mousePosition.clientY;var a=0,d=o.width-e.width,s=0,l=o.height-e.height;return a>i.left+n.__dx?n.__dx=-i.left:d<i.left+n.__dx&&(n.__dx=d-i.left),s>i.top+n.__dy?n.__dy=-i.top:l<i.top+n.__dy&&(n.__dy=l-i.top),{left:i.left+n.__dx+$(document).scrollLeft(),top:i.top+n.__dy+$(document).scrollTop()}};n.__dx=0,n.__dy=0,jQuery(document.body).bind(d.mousemove+".ax5modal-"+t.id,function(t){n.resizer||(n.resizerBg=jQuery('<div class="ax5modal-resizer-background" ondragstart="return false;"></div>'),n.resizer=jQuery('<div class="ax5modal-resizer" ondragstart="return false;"></div>'),n.resizer.css({left:i.left,top:i.top,width:e.width,height:e.height}),jQuery(document.body).append(n.resizerBg).append(n.resizer),n.activeModal.addClass("draged")),n.resizer.css(a(t))}).bind(d.mouseup+".ax5layout-"+this.instanceId,function(t){g.off.call(n)}).bind("mouseleave.ax5layout-"+this.instanceId,function(t){g.off.call(n)}),jQuery(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){var i=function(){var t=this.activeModal.offset();t.left+=this.__dx-$(document).scrollLeft(),t.top+=this.__dy-$(document).scrollTop(),this.activeModal.css(t)};this.resizer&&(this.activeModal.removeClass("draged"),this.resizer.remove(),this.resizer=null,this.resizerBg.remove(),this.resizerBg=null,i.call(this)),jQuery(document.body).unbind(d.mousemove+".ax5modal-"+t.id).unbind(d.mouseup+".ax5modal-"+t.id).unbind("mouseleave.ax5modal-"+t.id),jQuery(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}};this.init=function(){this.onStateChanged=t.onStateChanged},this.open=function(i,e){return this.activeModal||(i=n.modalConfig=jQuery.extend(!0,{},t,i),m.call(this,i,e)),this},this.close=function(i){return this.activeModal&&(i=n.modalConfig,this.activeModal.addClass("destroy"),jQuery(window).unbind("keydown.ax-modal"),jQuery(window).unbind("resize.ax-modal"),setTimeout(function(){this.activeModal.remove(),this.activeModal=null,l.call(this,i,{self:this,state:"close"})}.bind(this),t.animateTime)),this},this.minimize=function(){return function(i){var e=n.modalConfig;return"undefined"==typeof i&&(i=t.minimizePosition),this.minimized=!0,this.$.body.hide(),n.modalConfig.originalHeight=e.height,n.modalConfig.height=0,f[i].call(this),l.call(this,e,{self:this,state:"minimize"}),this}}(),this.maximize=function(){var t=n.modalConfig;return this.minimized&&(this.minimized=!1,this.$.body.show(),n.modalConfig.height=n.modalConfig.originalHeight,n.modalConfig.originalHeight=void 0,this.align({left:"center",top:"middle"}),l.call(this,t,{self:this,state:"restore"})),this},this.css=function(t){return this.activeModal&&!n.fullScreen&&(this.activeModal.css(t),t.width&&(n.modalConfig.width=this.activeModal.width()),t.height&&(n.modalConfig.height=this.activeModal.height(),this.$.iframe&&(this.$["iframe-wrap"].css({height:n.modalConfig.height}),this.$.iframe.css({height:n.modalConfig.height})))),this},this.align=function(){return function(t,i){if(!this.activeModal)return this;var e=n.modalConfig,o={width:e.width,height:e.height};return e.fullScreen?(e.header&&this.$.header.hide(),o.width=jQuery(window).width(),o.height=jQuery(window).height(),o.left=0,o.top=0,e.iframe&&(this.$["iframe-wrap"].css({height:o.height}),this.$.iframe.css({height:o.height}))):(t&&jQuery.extend(!0,e.position,t),e.header&&(o.height+=this.$.header.outerHeight()),"left"==e.position.left?o.left=e.position.margin||0:"right"==e.position.left?o.left=jQuery(window).width()-o.width-(e.position.margin||0):"center"==e.position.left?o.left=jQuery(window).width()/2-o.width/2:o.left=e.position.left||0,"top"==e.position.top?o.top=e.position.margin||0:"bottom"==e.position.top?o.top=jQuery(window).height()-o.height-(e.position.margin||0):"middle"==e.position.top?o.top=jQuery(window).height()/2-o.height/2:o.top=e.position.top||0),this.activeModal.css(o),this}}(),this.main=function(){root.modal_instance=root.modal_instance||[],root.modal_instance.push(this),arguments&&e.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.modal=function(){return e.isFunction(i)&&(n.prototype=new i),n}()}();